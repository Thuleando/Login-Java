<?xml version = '1.0' encoding = 'UTF-8'?>
<StoredProcedureOraclev10g class="oracle.dbtools.crest.model.design.storage.oracle.v10g.StoredProcedureOraclev10g" name="Login_SP" directorySegmentName="seg_0" id="39CDDAFF-D7B9-2BC0-80A6-B1646093DFA8">
<createdBy>Jason</createdBy>
<createdTime>2014-11-09 06:38:32 UTC</createdTime>
<comment>If the entered username doesn&apos;t match any account, no login attempt is recorded. If it does, then a login attempt (successful or unsuccesful) is recorded. A wrong password will cause an unsuccessful login attempt to be recorded, as will any attempt while the account is locked.</comment>
<ownerDesignName>Login_Authenticator</ownerDesignName>
<source>create or replace PROCEDURE Login_SP(UNameEntry IN Accounts.Username%TYPE,&lt;br/&gt;                                  PWordEntry IN Accounts.PWord%TYPE)&lt;br/&gt;&lt;br/&gt;IS&lt;br/&gt;  IDVar               Accounts.ID%TYPE;&lt;br/&gt;  UNameVar            Accounts.Username%TYPE;&lt;br/&gt;  PWordVar            Accounts.PWord%TYPE;&lt;br/&gt;  LockDateVar         Accounts.LockDate%TYPE;&lt;br/&gt;  UserCountVar        NUMERIC(2) NOT NULL := 0;&lt;br/&gt;  CurrTimestampVar    TIMESTAMP;&lt;br/&gt;&lt;br/&gt;BEGIN&lt;br/&gt;  SELECT LOCALTIMESTAMP INTO CurrTimestampVar FROM DUAL;&lt;br/&gt;&lt;br/&gt;  SELECT COUNT(Accounts.ID) INTO UserCountVar FROM Accounts&lt;br/&gt;  WHERE Accounts.Username = UNameEntry;&lt;br/&gt;  &lt;br/&gt;  IF UserCountVar != 1 THEN&lt;br/&gt;    DBMS_OUTPUT.PUT_LINE(&apos;Invalid username.&apos;);&lt;br/&gt;    &lt;br/&gt;  ELSE  &lt;br/&gt;    SELECT Accounts.Username INTO UNameVar FROM Accounts&lt;br/&gt;    WHERE Accounts.Username = UNameEntry;&lt;br/&gt;    SELECT Accounts.ID INTO IDVar FROM Accounts&lt;br/&gt;    WHERE Accounts.Username = UNameEntry;&lt;br/&gt;    SELECT Accounts.LockDate INTO LockDateVar FROM Accounts&lt;br/&gt;    WHERE Accounts.Username = UNameEntry;&lt;br/&gt;  &lt;br/&gt;    IF LockDateVar IS NOT NULL THEN&lt;br/&gt;      INSERT INTO V_LoginAttempts VALUES (IDVar, CurrTimestampVar, &apos;N&apos;);&lt;br/&gt;    ELSE  &lt;br/&gt;      SELECT Accounts.PWord INTO PWordVar FROM Accounts&lt;br/&gt;      WHERE Accounts.Username = UNameEntry;&lt;br/&gt;    &lt;br/&gt;      IF PWordEntry != PWordVar THEN&lt;br/&gt;        INSERT INTO V_LoginAttempts VALUES (IDVar, CurrTimestampVar, &apos;N&apos;);&lt;br/&gt;      ELSE&lt;br/&gt;        INSERT INTO V_LoginAttempts VALUES (IDVar, CurrTimestampVar, &apos;Y&apos;);&lt;br/&gt;      END IF;&lt;br/&gt;    END IF;&lt;br/&gt;  END IF;&lt;br/&gt;&lt;br/&gt;END Login_SP;</source>
<body>create or replace PROCEDURE Login_SP(UNameEntry IN Accounts.Username%TYPE,&lt;br/&gt;                                  PWordEntry IN Accounts.PWord%TYPE)&lt;br/&gt;&lt;br/&gt;IS&lt;br/&gt;  IDVar               Accounts.ID%TYPE;&lt;br/&gt;  UNameVar            Accounts.Username%TYPE;&lt;br/&gt;  PWordVar            Accounts.PWord%TYPE;&lt;br/&gt;  LockDateVar         Accounts.LockDate%TYPE;&lt;br/&gt;  UserCountVar        NUMERIC(2) NOT NULL := 0;&lt;br/&gt;  CurrTimestampVar    TIMESTAMP;&lt;br/&gt;&lt;br/&gt;BEGIN&lt;br/&gt;  SELECT LOCALTIMESTAMP INTO CurrTimestampVar FROM DUAL;&lt;br/&gt;&lt;br/&gt;  SELECT COUNT(Accounts.ID) INTO UserCountVar FROM Accounts&lt;br/&gt;  WHERE Accounts.Username = UNameEntry;&lt;br/&gt;  &lt;br/&gt;  IF UserCountVar != 1 THEN&lt;br/&gt;    DBMS_OUTPUT.PUT_LINE(&apos;Invalid username.&apos;);&lt;br/&gt;    &lt;br/&gt;  ELSE  &lt;br/&gt;    SELECT Accounts.Username INTO UNameVar FROM Accounts&lt;br/&gt;    WHERE Accounts.Username = UNameEntry;&lt;br/&gt;    SELECT Accounts.ID INTO IDVar FROM Accounts&lt;br/&gt;    WHERE Accounts.Username = UNameEntry;&lt;br/&gt;    SELECT Accounts.LockDate INTO LockDateVar FROM Accounts&lt;br/&gt;    WHERE Accounts.Username = UNameEntry;&lt;br/&gt;  &lt;br/&gt;    IF LockDateVar IS NOT NULL THEN&lt;br/&gt;      INSERT INTO V_LoginAttempts VALUES (IDVar, CurrTimestampVar, &apos;N&apos;);&lt;br/&gt;    ELSE  &lt;br/&gt;      SELECT Accounts.PWord INTO PWordVar FROM Accounts&lt;br/&gt;      WHERE Accounts.Username = UNameEntry;&lt;br/&gt;    &lt;br/&gt;      IF PWordEntry != PWordVar THEN&lt;br/&gt;        INSERT INTO V_LoginAttempts VALUES (IDVar, CurrTimestampVar, &apos;N&apos;);&lt;br/&gt;      ELSE&lt;br/&gt;        INSERT INTO V_LoginAttempts VALUES (IDVar, CurrTimestampVar, &apos;Y&apos;);&lt;br/&gt;      END IF;&lt;br/&gt;    END IF;&lt;br/&gt;  END IF;&lt;br/&gt;&lt;br/&gt;END Login_SP;</body>
</StoredProcedureOraclev10g>